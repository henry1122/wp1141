{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useState } from 'react';\nexport const useAudio = () => {\n  _s();\n  const audioContextRef = useRef({\n    audioContext: null,\n    masterGain: null\n  });\n  const backgroundMusicRef = useRef(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n\n  // 初始化音頻上下文\n  const initAudioContext = () => {\n    if (!audioContextRef.current.audioContext) {\n      const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      const masterGain = audioContext.createGain();\n      masterGain.connect(audioContext.destination);\n      masterGain.gain.value = 0.3; // 主音量\n\n      audioContextRef.current = {\n        audioContext,\n        masterGain\n      };\n    }\n  };\n\n  // 播放背景音樂\n  const playBackgroundMusic = () => {\n    const musicEnabled = localStorage.getItem('musicEnabled') !== 'false';\n    if (!musicEnabled) return;\n    initAudioContext();\n    const {\n      audioContext,\n      masterGain\n    } = audioContextRef.current;\n    if (!audioContext || !masterGain) return;\n\n    // 停止當前音樂\n    stopBackgroundMusic();\n\n    // 創建和諧的背景音樂\n    const createTone = (frequency, gain, delay = 0) => {\n      setTimeout(() => {\n        const oscillator = audioContext.createOscillator();\n        const gainNode = audioContext.createGain();\n        oscillator.type = 'sine';\n        oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);\n        gainNode.gain.setValueAtTime(0, audioContext.currentTime);\n        gainNode.gain.linearRampToValueAtTime(gain, audioContext.currentTime + 0.5);\n        oscillator.connect(gainNode);\n        gainNode.connect(masterGain);\n        oscillator.start();\n\n        // 音調變化\n        oscillator.frequency.exponentialRampToValueAtTime(frequency * 1.1, audioContext.currentTime + 4);\n        if (!backgroundMusicRef.current) {\n          backgroundMusicRef.current = oscillator;\n        }\n      }, delay);\n    };\n\n    // 創建和弦\n    createTone(220, 0.1, 0); // A3\n    createTone(330, 0.08, 500); // E4\n    createTone(440, 0.06, 1000); // A4\n\n    setIsPlaying(true);\n  };\n\n  // 停止背景音樂\n  const stopBackgroundMusic = () => {\n    if (backgroundMusicRef.current) {\n      try {\n        backgroundMusicRef.current.stop();\n      } catch (e) {\n        // 忽略已經停止的錯誤\n      }\n      backgroundMusicRef.current = null;\n    }\n    setIsPlaying(false);\n  };\n\n  // 播放音效\n  const playSound = type => {\n    const soundEnabled = localStorage.getItem('soundEnabled') !== 'false';\n    if (!soundEnabled) return;\n    initAudioContext();\n    const {\n      audioContext,\n      masterGain\n    } = audioContextRef.current;\n    if (!audioContext || !masterGain) return;\n    const oscillator = audioContext.createOscillator();\n    const gainNode = audioContext.createGain();\n\n    // 根據音效類型設置不同的頻率和包絡\n    switch (type) {\n      case 'match':\n        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);\n        oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.2);\n        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);\n        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);\n        break;\n      case 'drop':\n        oscillator.frequency.setValueAtTime(400, audioContext.currentTime);\n        oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.1);\n        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);\n        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);\n        break;\n      case 'levelUp':\n        oscillator.frequency.setValueAtTime(600, audioContext.currentTime);\n        oscillator.frequency.exponentialRampToValueAtTime(1000, audioContext.currentTime + 0.5);\n        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\n        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);\n        break;\n      case 'gameOver':\n        oscillator.frequency.setValueAtTime(300, audioContext.currentTime);\n        oscillator.frequency.exponentialRampToValueAtTime(150, audioContext.currentTime + 1);\n        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);\n        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);\n        break;\n    }\n    oscillator.type = 'sine';\n    oscillator.connect(gainNode);\n    gainNode.connect(masterGain);\n    oscillator.start();\n    oscillator.stop(audioContext.currentTime + (type === 'gameOver' ? 1 : type === 'levelUp' ? 0.5 : 0.2));\n  };\n\n  // 清理音頻資源\n  useEffect(() => {\n    return () => {\n      stopBackgroundMusic();\n      if (audioContextRef.current.audioContext) {\n        audioContextRef.current.audioContext.close();\n      }\n    };\n  }, []);\n  return {\n    playBackgroundMusic,\n    stopBackgroundMusic,\n    playSound,\n    isPlaying\n  };\n};\n_s(useAudio, \"/lPGvK/92JUB+a9BeAijHRaKC2E=\");","map":{"version":3,"names":["useEffect","useRef","useState","useAudio","_s","audioContextRef","audioContext","masterGain","backgroundMusicRef","isPlaying","setIsPlaying","initAudioContext","current","window","AudioContext","webkitAudioContext","createGain","connect","destination","gain","value","playBackgroundMusic","musicEnabled","localStorage","getItem","stopBackgroundMusic","createTone","frequency","delay","setTimeout","oscillator","createOscillator","gainNode","type","setValueAtTime","currentTime","linearRampToValueAtTime","start","exponentialRampToValueAtTime","stop","e","playSound","soundEnabled","close"],"sources":["C:/Users/User/Desktop/wp1141/hw2/src/hooks/useAudio.ts"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\r\n\r\ninterface AudioContextType {\r\n  audioContext: AudioContext | null;\r\n  masterGain: GainNode | null;\r\n}\r\n\r\nexport const useAudio = () => {\r\n  const audioContextRef = useRef<AudioContextType>({ audioContext: null, masterGain: null });\r\n  const backgroundMusicRef = useRef<OscillatorNode | null>(null);\r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n\r\n  // 初始化音頻上下文\r\n  const initAudioContext = () => {\r\n    if (!audioContextRef.current.audioContext) {\r\n      const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n      const masterGain = audioContext.createGain();\r\n      masterGain.connect(audioContext.destination);\r\n      masterGain.gain.value = 0.3; // 主音量\r\n      \r\n      audioContextRef.current = { audioContext, masterGain };\r\n    }\r\n  };\r\n\r\n  // 播放背景音樂\r\n  const playBackgroundMusic = () => {\r\n    const musicEnabled = localStorage.getItem('musicEnabled') !== 'false';\r\n    if (!musicEnabled) return;\r\n\r\n    initAudioContext();\r\n    const { audioContext, masterGain } = audioContextRef.current;\r\n    if (!audioContext || !masterGain) return;\r\n\r\n    // 停止當前音樂\r\n    stopBackgroundMusic();\r\n\r\n    // 創建和諧的背景音樂\r\n    const createTone = (frequency: number, gain: number, delay: number = 0) => {\r\n      setTimeout(() => {\r\n        const oscillator = audioContext.createOscillator();\r\n        const gainNode = audioContext.createGain();\r\n        \r\n        oscillator.type = 'sine';\r\n        oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);\r\n        \r\n        gainNode.gain.setValueAtTime(0, audioContext.currentTime);\r\n        gainNode.gain.linearRampToValueAtTime(gain, audioContext.currentTime + 0.5);\r\n        \r\n        oscillator.connect(gainNode);\r\n        gainNode.connect(masterGain);\r\n        \r\n        oscillator.start();\r\n        \r\n        // 音調變化\r\n        oscillator.frequency.exponentialRampToValueAtTime(\r\n          frequency * 1.1, \r\n          audioContext.currentTime + 4\r\n        );\r\n        \r\n        if (!backgroundMusicRef.current) {\r\n          backgroundMusicRef.current = oscillator;\r\n        }\r\n      }, delay);\r\n    };\r\n\r\n    // 創建和弦\r\n    createTone(220, 0.1, 0);    // A3\r\n    createTone(330, 0.08, 500); // E4\r\n    createTone(440, 0.06, 1000); // A4\r\n    \r\n    setIsPlaying(true);\r\n  };\r\n\r\n  // 停止背景音樂\r\n  const stopBackgroundMusic = () => {\r\n    if (backgroundMusicRef.current) {\r\n      try {\r\n        backgroundMusicRef.current.stop();\r\n      } catch (e) {\r\n        // 忽略已經停止的錯誤\r\n      }\r\n      backgroundMusicRef.current = null;\r\n    }\r\n    setIsPlaying(false);\r\n  };\r\n\r\n  // 播放音效\r\n  const playSound = (type: 'match' | 'drop' | 'levelUp' | 'gameOver') => {\r\n    const soundEnabled = localStorage.getItem('soundEnabled') !== 'false';\r\n    if (!soundEnabled) return;\r\n\r\n    initAudioContext();\r\n    const { audioContext, masterGain } = audioContextRef.current;\r\n    if (!audioContext || !masterGain) return;\r\n\r\n    const oscillator = audioContext.createOscillator();\r\n    const gainNode = audioContext.createGain();\r\n    \r\n    // 根據音效類型設置不同的頻率和包絡\r\n    switch (type) {\r\n      case 'match':\r\n        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);\r\n        oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.2);\r\n        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);\r\n        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);\r\n        break;\r\n        \r\n      case 'drop':\r\n        oscillator.frequency.setValueAtTime(400, audioContext.currentTime);\r\n        oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.1);\r\n        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);\r\n        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);\r\n        break;\r\n        \r\n      case 'levelUp':\r\n        oscillator.frequency.setValueAtTime(600, audioContext.currentTime);\r\n        oscillator.frequency.exponentialRampToValueAtTime(1000, audioContext.currentTime + 0.5);\r\n        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);\r\n        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);\r\n        break;\r\n        \r\n      case 'gameOver':\r\n        oscillator.frequency.setValueAtTime(300, audioContext.currentTime);\r\n        oscillator.frequency.exponentialRampToValueAtTime(150, audioContext.currentTime + 1);\r\n        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);\r\n        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);\r\n        break;\r\n    }\r\n    \r\n    oscillator.type = 'sine';\r\n    oscillator.connect(gainNode);\r\n    gainNode.connect(masterGain);\r\n    \r\n    oscillator.start();\r\n    oscillator.stop(audioContext.currentTime + (type === 'gameOver' ? 1 : type === 'levelUp' ? 0.5 : 0.2));\r\n  };\r\n\r\n  // 清理音頻資源\r\n  useEffect(() => {\r\n    return () => {\r\n      stopBackgroundMusic();\r\n      if (audioContextRef.current.audioContext) {\r\n        audioContextRef.current.audioContext.close();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return {\r\n    playBackgroundMusic,\r\n    stopBackgroundMusic,\r\n    playSound,\r\n    isPlaying,\r\n  };\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}