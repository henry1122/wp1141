{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useCallback, useEffect, useRef } from 'react';\nimport { GameState } from '../types/game';\nimport { createEmptyBoard, generateRandomBall, findAllMatches, applyGravity, removeBalls, calculateScore, isGameOver, canPlaceBall, getLowestEmptyRow, GAME_CONFIG } from '../utils/gameLogic';\nimport { useHighScore } from './useHighScore';\nimport { Difficulty, LEVEL_CONFIGS, getNextLevel } from '../types/levels';\nexport const useGameState = () => {\n  _s();\n  const {\n    checkAndUpdateHighScore,\n    highScore,\n    isNewHighScore\n  } = useHighScore();\n  const [gameState, setGameState] = useState(GameState.MENU);\n  const [currentDifficulty, setCurrentDifficulty] = useState(Difficulty.EASY);\n  const [board, setBoard] = useState(createEmptyBoard());\n  const [nextBall, setNextBall] = useState(null);\n  const [stats, setStats] = useState({\n    score: 0,\n    level: 1,\n    linesCleared: 0,\n    combo: 0,\n    timeElapsed: 0\n  });\n  const [levelComplete, setLevelComplete] = useState(false);\n  const gameLoopRef = useRef(null);\n  const dropTimerRef = useRef(null);\n  const timeTimerRef = useRef(null);\n  const currentLevelConfig = LEVEL_CONFIGS[currentDifficulty];\n\n  // 初始化下一個球\n  const initializeNextBall = useCallback(() => {\n    const ball = generateRandomBall({\n      row: 0,\n      col: 0\n    });\n    setNextBall(ball);\n  }, []);\n\n  // 隨機掉落球\n  const dropRandomBall = useCallback(() => {\n    setBoard(currentBoard => {\n      const availableColumns = [];\n      for (let col = 0; col < GAME_CONFIG.BOARD_WIDTH; col++) {\n        if (canPlaceBall(currentBoard, col)) {\n          availableColumns.push(col);\n        }\n      }\n      if (availableColumns.length === 0) {\n        setGameState(GameState.GAME_OVER);\n        return currentBoard;\n      }\n      const randomCol = availableColumns[Math.floor(Math.random() * availableColumns.length)];\n      const row = getLowestEmptyRow(currentBoard, randomCol);\n      if (row === -1) {\n        setGameState(GameState.GAME_OVER);\n        return currentBoard;\n      }\n      const ball = generateRandomBall({\n        row,\n        col: randomCol\n      });\n      const newBoard = [...currentBoard];\n      newBoard[row][randomCol] = ball;\n      return newBoard;\n    });\n  }, []);\n\n  // 處理連鎖反應\n  const processMatches = useCallback(currentBoard => {\n    let newBoard = [...currentBoard.map(row => [...row])];\n    let totalMatches = 0;\n    let comboCount = 0;\n    const processRound = () => {\n      const matches = findAllMatches(newBoard);\n      if (matches.length === 0) {\n        // 沒有更多匹配，結束連鎖\n        if (totalMatches > 0) {\n          const scoreGain = calculateScore(totalMatches, comboCount);\n          setStats(prev => {\n            const newScore = prev.score + scoreGain;\n            const newStats = {\n              ...prev,\n              score: newScore,\n              linesCleared: prev.linesCleared + Math.floor(totalMatches / currentLevelConfig.minMatchCount),\n              combo: comboCount,\n              level: Math.floor(newScore / 1000) + 1\n            };\n\n            // 檢查是否完成當前關卡\n            if (newScore >= currentLevelConfig.targetScore && !levelComplete) {\n              console.log('Level complete!', {\n                newScore,\n                target: currentLevelConfig.targetScore,\n                levelComplete\n              });\n              setTimeout(() => setLevelComplete(true), 1000);\n            }\n            return newStats;\n          });\n\n          // 重置連擊計數器\n          setTimeout(() => {\n            setStats(prev => ({\n              ...prev,\n              combo: 0\n            }));\n          }, 2000);\n        }\n        return;\n      }\n\n      // 移除匹配的球\n      newBoard = removeBalls(newBoard, matches);\n      totalMatches += matches.length;\n      comboCount++;\n\n      // 等待爆炸動畫完成後應用重力\n      setTimeout(() => {\n        // 實際移除球\n        matches.forEach(pos => {\n          newBoard[pos.row][pos.col] = null;\n        });\n\n        // 應用重力\n        newBoard = applyGravity(newBoard);\n        setBoard(newBoard);\n\n        // 繼續處理下一輪匹配\n        setTimeout(() => processRound(), 600);\n      }, 400);\n    };\n    processRound();\n  }, [currentLevelConfig.minMatchCount, currentLevelConfig.targetScore, levelComplete]);\n\n  // 開始遊戲\n  const startGame = useCallback(difficulty => {\n    if (difficulty) {\n      setCurrentDifficulty(difficulty);\n    }\n    setGameState(GameState.PLAYING);\n    setBoard(createEmptyBoard());\n    setStats({\n      score: 0,\n      level: 1,\n      linesCleared: 0,\n      combo: 0,\n      timeElapsed: 0\n    });\n    setLevelComplete(false);\n    initializeNextBall();\n\n    // 開始時間計時器\n    if (timeTimerRef.current) clearInterval(timeTimerRef.current);\n    timeTimerRef.current = setInterval(() => {\n      setStats(prev => ({\n        ...prev,\n        timeElapsed: prev.timeElapsed + 1\n      }));\n    }, 1000);\n    const levelConfig = difficulty ? LEVEL_CONFIGS[difficulty] : currentLevelConfig;\n\n    // 開始自動掉落計時器\n    if (dropTimerRef.current) clearInterval(dropTimerRef.current);\n    dropTimerRef.current = setInterval(() => {\n      dropRandomBall();\n    }, levelConfig.dropInterval);\n  }, [initializeNextBall, dropRandomBall, currentLevelConfig]);\n\n  // 暫停遊戲\n  const pauseGame = useCallback(() => {\n    setGameState(GameState.PAUSED);\n    if (dropTimerRef.current) clearInterval(dropTimerRef.current);\n    if (timeTimerRef.current) clearInterval(timeTimerRef.current);\n  }, []);\n\n  // 恢復遊戲\n  const resumeGame = useCallback(() => {\n    setGameState(GameState.PLAYING);\n    if (timeTimerRef.current) clearInterval(timeTimerRef.current);\n    timeTimerRef.current = setInterval(() => {\n      setStats(prev => ({\n        ...prev,\n        timeElapsed: prev.timeElapsed + 1\n      }));\n    }, 1000);\n    if (dropTimerRef.current) clearInterval(dropTimerRef.current);\n    dropTimerRef.current = setInterval(() => {\n      dropRandomBall();\n    }, GAME_CONFIG.DROP_INTERVAL);\n  }, [dropRandomBall]);\n\n  // 結束遊戲\n  const endGame = useCallback(() => {\n    setGameState(GameState.GAME_OVER);\n    if (dropTimerRef.current) clearInterval(dropTimerRef.current);\n    if (timeTimerRef.current) clearInterval(timeTimerRef.current);\n    if (gameLoopRef.current) clearInterval(gameLoopRef.current);\n\n    // 檢查最高分\n    checkAndUpdateHighScore(stats.score, stats.level);\n  }, [checkAndUpdateHighScore, stats.score, stats.level]);\n\n  // 點擊格子放置球\n  const handleCellClick = useCallback((row, col) => {\n    if (gameState !== GameState.PLAYING || !nextBall) return;\n    const targetRow = getLowestEmptyRow(board, col);\n    if (targetRow === -1) return; // 該列已滿\n\n    // 放置球\n    const newBoard = [...board];\n    const ballToPlace = {\n      ...nextBall,\n      position: {\n        row: targetRow,\n        col\n      }\n    };\n    newBoard[targetRow][col] = ballToPlace;\n    setBoard(newBoard);\n\n    // 生成下一個球\n    initializeNextBall();\n\n    // 檢查匹配\n    setTimeout(() => {\n      processMatches(newBoard);\n    }, 100);\n\n    // 檢查遊戲結束\n    if (isGameOver(newBoard)) {\n      endGame();\n    }\n  }, [gameState, nextBall, board, processMatches, initializeNextBall, endGame]);\n\n  // 重置遊戲\n  const resetGame = useCallback(() => {\n    setGameState(GameState.MENU);\n    setBoard(createEmptyBoard());\n    setStats({\n      score: 0,\n      level: 1,\n      linesCleared: 0,\n      combo: 0,\n      timeElapsed: 0\n    });\n    setNextBall(null);\n    if (dropTimerRef.current) clearInterval(dropTimerRef.current);\n    if (timeTimerRef.current) clearInterval(timeTimerRef.current);\n    if (gameLoopRef.current) clearInterval(gameLoopRef.current);\n  }, []);\n\n  // 清理計時器\n  useEffect(() => {\n    return () => {\n      if (dropTimerRef.current) clearInterval(dropTimerRef.current);\n      if (timeTimerRef.current) clearInterval(timeTimerRef.current);\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      if (gameLoopRef.current) clearInterval(gameLoopRef.current);\n    };\n  }, []);\n\n  // 進入下一關\n  const nextLevelHandler = useCallback(() => {\n    const next = getNextLevel(currentDifficulty);\n    if (next) {\n      setLevelComplete(false);\n      setCurrentDifficulty(next.id);\n      // 使用 setTimeout 確保狀態更新後再開始遊戲\n      setTimeout(() => {\n        startGame(next.id);\n      }, 100);\n    }\n  }, [currentDifficulty, startGame]);\n\n  // 設置難度\n  const setDifficultyHandler = useCallback(difficulty => {\n    setCurrentDifficulty(difficulty);\n  }, []);\n\n  // 重置關卡完成狀態\n  const resetLevelComplete = useCallback(() => {\n    setLevelComplete(false);\n  }, []);\n  return {\n    gameState,\n    board,\n    nextBall,\n    stats,\n    highScore,\n    isNewHighScore,\n    currentDifficulty,\n    currentLevelConfig,\n    levelComplete,\n    startGame,\n    pauseGame,\n    resumeGame,\n    resetGame,\n    nextLevel: nextLevelHandler,\n    setDifficulty: setDifficultyHandler,\n    resetLevelComplete,\n    handleCellClick\n  };\n};\n_s(useGameState, \"AKIGXhqZ0FsnAqMfWxiEzWqeRCA=\", false, function () {\n  return [useHighScore];\n});","map":{"version":3,"names":["useState","useCallback","useEffect","useRef","GameState","createEmptyBoard","generateRandomBall","findAllMatches","applyGravity","removeBalls","calculateScore","isGameOver","canPlaceBall","getLowestEmptyRow","GAME_CONFIG","useHighScore","Difficulty","LEVEL_CONFIGS","getNextLevel","useGameState","_s","checkAndUpdateHighScore","highScore","isNewHighScore","gameState","setGameState","MENU","currentDifficulty","setCurrentDifficulty","EASY","board","setBoard","nextBall","setNextBall","stats","setStats","score","level","linesCleared","combo","timeElapsed","levelComplete","setLevelComplete","gameLoopRef","dropTimerRef","timeTimerRef","currentLevelConfig","initializeNextBall","ball","row","col","dropRandomBall","currentBoard","availableColumns","BOARD_WIDTH","push","length","GAME_OVER","randomCol","Math","floor","random","newBoard","processMatches","map","totalMatches","comboCount","processRound","matches","scoreGain","prev","newScore","newStats","minMatchCount","targetScore","console","log","target","setTimeout","forEach","pos","startGame","difficulty","PLAYING","current","clearInterval","setInterval","levelConfig","dropInterval","pauseGame","PAUSED","resumeGame","DROP_INTERVAL","endGame","handleCellClick","targetRow","ballToPlace","position","resetGame","nextLevelHandler","next","id","setDifficultyHandler","resetLevelComplete","nextLevel","setDifficulty"],"sources":["C:/Users/User/Desktop/wp1141/hw2/src/hooks/useGameState.ts"],"sourcesContent":["import { useState, useCallback, useEffect, useRef } from 'react';\nimport { \n  Ball, \n  GameState, \n  GameStats\n} from '../types/game';\nimport {\n  createEmptyBoard,\n  generateRandomBall,\n  findAllMatches,\n  applyGravity,\n  removeBalls,\n  calculateScore,\n  isGameOver,\n  canPlaceBall,\n  getLowestEmptyRow,\n  GAME_CONFIG\n} from '../utils/gameLogic';\nimport { useHighScore } from './useHighScore';\nimport { Difficulty, LEVEL_CONFIGS, getNextLevel } from '../types/levels';\n\nexport const useGameState = () => {\n  const { checkAndUpdateHighScore, highScore, isNewHighScore } = useHighScore();\n  const [gameState, setGameState] = useState<GameState>(GameState.MENU);\n  const [currentDifficulty, setCurrentDifficulty] = useState<Difficulty>(Difficulty.EASY);\n  const [board, setBoard] = useState<(Ball | null)[][]>(createEmptyBoard());\n  const [nextBall, setNextBall] = useState<Ball | null>(null);\n  const [stats, setStats] = useState<GameStats>({\n    score: 0,\n    level: 1,\n    linesCleared: 0,\n    combo: 0,\n    timeElapsed: 0\n  });\n  const [levelComplete, setLevelComplete] = useState(false);\n\n  const gameLoopRef = useRef<NodeJS.Timeout | null>(null);\n  const dropTimerRef = useRef<NodeJS.Timeout | null>(null);\n  const timeTimerRef = useRef<NodeJS.Timeout | null>(null);\n  const currentLevelConfig = LEVEL_CONFIGS[currentDifficulty];\n\n  // 初始化下一個球\n  const initializeNextBall = useCallback(() => {\n    const ball = generateRandomBall({ row: 0, col: 0 });\n    setNextBall(ball);\n  }, []);\n\n  // 隨機掉落球\n  const dropRandomBall = useCallback(() => {\n    setBoard(currentBoard => {\n      const availableColumns = [];\n      for (let col = 0; col < GAME_CONFIG.BOARD_WIDTH; col++) {\n        if (canPlaceBall(currentBoard, col)) {\n          availableColumns.push(col);\n        }\n      }\n\n      if (availableColumns.length === 0) {\n        setGameState(GameState.GAME_OVER);\n        return currentBoard;\n      }\n\n      const randomCol = availableColumns[Math.floor(Math.random() * availableColumns.length)];\n      const row = getLowestEmptyRow(currentBoard, randomCol);\n      \n      if (row === -1) {\n        setGameState(GameState.GAME_OVER);\n        return currentBoard;\n      }\n\n      const ball = generateRandomBall({ row, col: randomCol });\n      const newBoard = [...currentBoard];\n      newBoard[row][randomCol] = ball;\n\n      return newBoard;\n    });\n  }, []);\n\n  // 處理連鎖反應\n  const processMatches = useCallback((currentBoard: (Ball | null)[][]) => {\n    let newBoard = [...currentBoard.map(row => [...row])];\n    let totalMatches = 0;\n    let comboCount = 0;\n\n    const processRound = () => {\n      const matches = findAllMatches(newBoard);\n      \n      if (matches.length === 0) {\n        // 沒有更多匹配，結束連鎖\n        if (totalMatches > 0) {\n          const scoreGain = calculateScore(totalMatches, comboCount);\n          setStats(prev => {\n            const newScore = prev.score + scoreGain;\n            const newStats = {\n              ...prev,\n              score: newScore,\n              linesCleared: prev.linesCleared + Math.floor(totalMatches / currentLevelConfig.minMatchCount),\n              combo: comboCount,\n              level: Math.floor(newScore / 1000) + 1\n            };\n            \n            // 檢查是否完成當前關卡\n            if (newScore >= currentLevelConfig.targetScore && !levelComplete) {\n              console.log('Level complete!', { newScore, target: currentLevelConfig.targetScore, levelComplete });\n              setTimeout(() => setLevelComplete(true), 1000);\n            }\n            \n            return newStats;\n          });\n\n          // 重置連擊計數器\n          setTimeout(() => {\n            setStats(prev => ({ ...prev, combo: 0 }));\n          }, 2000);\n        }\n        return;\n      }\n\n      // 移除匹配的球\n      newBoard = removeBalls(newBoard, matches);\n      totalMatches += matches.length;\n      comboCount++;\n\n      // 等待爆炸動畫完成後應用重力\n      setTimeout(() => {\n        // 實際移除球\n        matches.forEach(pos => {\n          newBoard[pos.row][pos.col] = null;\n        });\n        \n        // 應用重力\n        newBoard = applyGravity(newBoard);\n        setBoard(newBoard);\n        \n        // 繼續處理下一輪匹配\n        setTimeout(() => processRound(), 600);\n      }, 400);\n    };\n\n    processRound();\n  }, [currentLevelConfig.minMatchCount, currentLevelConfig.targetScore, levelComplete]);\n\n  // 開始遊戲\n  const startGame = useCallback((difficulty?: Difficulty) => {\n    if (difficulty) {\n      setCurrentDifficulty(difficulty);\n    }\n    setGameState(GameState.PLAYING);\n    setBoard(createEmptyBoard());\n    setStats({\n      score: 0,\n      level: 1,\n      linesCleared: 0,\n      combo: 0,\n      timeElapsed: 0\n    });\n    setLevelComplete(false);\n    initializeNextBall();\n\n    // 開始時間計時器\n    if (timeTimerRef.current) clearInterval(timeTimerRef.current);\n    timeTimerRef.current = setInterval(() => {\n      setStats(prev => ({ ...prev, timeElapsed: prev.timeElapsed + 1 }));\n    }, 1000);\n\n    const levelConfig = difficulty ? LEVEL_CONFIGS[difficulty] : currentLevelConfig;\n\n    // 開始自動掉落計時器\n    if (dropTimerRef.current) clearInterval(dropTimerRef.current);\n    dropTimerRef.current = setInterval(() => {\n      dropRandomBall();\n    }, levelConfig.dropInterval);\n  }, [initializeNextBall, dropRandomBall, currentLevelConfig]);\n\n  // 暫停遊戲\n  const pauseGame = useCallback(() => {\n    setGameState(GameState.PAUSED);\n    if (dropTimerRef.current) clearInterval(dropTimerRef.current);\n    if (timeTimerRef.current) clearInterval(timeTimerRef.current);\n  }, []);\n\n  // 恢復遊戲\n  const resumeGame = useCallback(() => {\n    setGameState(GameState.PLAYING);\n    \n    if (timeTimerRef.current) clearInterval(timeTimerRef.current);\n    timeTimerRef.current = setInterval(() => {\n      setStats(prev => ({ ...prev, timeElapsed: prev.timeElapsed + 1 }));\n    }, 1000);\n\n    if (dropTimerRef.current) clearInterval(dropTimerRef.current);\n    dropTimerRef.current = setInterval(() => {\n      dropRandomBall();\n    }, GAME_CONFIG.DROP_INTERVAL);\n  }, [dropRandomBall]);\n\n  // 結束遊戲\n  const endGame = useCallback(() => {\n    setGameState(GameState.GAME_OVER);\n    if (dropTimerRef.current) clearInterval(dropTimerRef.current);\n    if (timeTimerRef.current) clearInterval(timeTimerRef.current);\n    if (gameLoopRef.current) clearInterval(gameLoopRef.current);\n    \n    // 檢查最高分\n    checkAndUpdateHighScore(stats.score, stats.level);\n  }, [checkAndUpdateHighScore, stats.score, stats.level]);\n\n  // 點擊格子放置球\n  const handleCellClick = useCallback((row: number, col: number) => {\n    if (gameState !== GameState.PLAYING || !nextBall) return;\n\n    const targetRow = getLowestEmptyRow(board, col);\n    if (targetRow === -1) return; // 該列已滿\n\n    // 放置球\n    const newBoard = [...board];\n    const ballToPlace = { ...nextBall, position: { row: targetRow, col } };\n    newBoard[targetRow][col] = ballToPlace;\n    \n    setBoard(newBoard);\n    \n    // 生成下一個球\n    initializeNextBall();\n    \n    // 檢查匹配\n    setTimeout(() => {\n      processMatches(newBoard);\n    }, 100);\n\n    // 檢查遊戲結束\n    if (isGameOver(newBoard)) {\n      endGame();\n    }\n  }, [gameState, nextBall, board, processMatches, initializeNextBall, endGame]);\n\n  // 重置遊戲\n  const resetGame = useCallback(() => {\n    setGameState(GameState.MENU);\n    setBoard(createEmptyBoard());\n    setStats({\n      score: 0,\n      level: 1,\n      linesCleared: 0,\n      combo: 0,\n      timeElapsed: 0\n    });\n    setNextBall(null);\n    \n    if (dropTimerRef.current) clearInterval(dropTimerRef.current);\n    if (timeTimerRef.current) clearInterval(timeTimerRef.current);\n    if (gameLoopRef.current) clearInterval(gameLoopRef.current);\n  }, []);\n\n  // 清理計時器\n  useEffect(() => {\n    return () => {\n      if (dropTimerRef.current) clearInterval(dropTimerRef.current);\n      if (timeTimerRef.current) clearInterval(timeTimerRef.current);\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      if (gameLoopRef.current) clearInterval(gameLoopRef.current);\n    };\n  }, []);\n\n  // 進入下一關\n  const nextLevelHandler = useCallback(() => {\n    const next = getNextLevel(currentDifficulty);\n    if (next) {\n      setLevelComplete(false);\n      setCurrentDifficulty(next.id);\n      // 使用 setTimeout 確保狀態更新後再開始遊戲\n      setTimeout(() => {\n        startGame(next.id);\n      }, 100);\n    }\n  }, [currentDifficulty, startGame]);\n\n  // 設置難度\n  const setDifficultyHandler = useCallback((difficulty: Difficulty) => {\n    setCurrentDifficulty(difficulty);\n  }, []);\n\n  // 重置關卡完成狀態\n  const resetLevelComplete = useCallback(() => {\n    setLevelComplete(false);\n  }, []);\n\n  return {\n    gameState,\n    board,\n    nextBall,\n    stats,\n    highScore,\n    isNewHighScore,\n    currentDifficulty,\n    currentLevelConfig,\n    levelComplete,\n    startGame,\n    pauseGame,\n    resumeGame,\n    resetGame,\n    nextLevel: nextLevelHandler,\n    setDifficulty: setDifficultyHandler,\n    resetLevelComplete,\n    handleCellClick\n  };\n};"],"mappings":";AAAA,SAASA,QAAQ,EAAEC,WAAW,EAAEC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AAChE,SAEEC,SAAS,QAEJ,eAAe;AACtB,SACEC,gBAAgB,EAChBC,kBAAkB,EAClBC,cAAc,EACdC,YAAY,EACZC,WAAW,EACXC,cAAc,EACdC,UAAU,EACVC,YAAY,EACZC,iBAAiB,EACjBC,WAAW,QACN,oBAAoB;AAC3B,SAASC,YAAY,QAAQ,gBAAgB;AAC7C,SAASC,UAAU,EAAEC,aAAa,EAAEC,YAAY,QAAQ,iBAAiB;AAEzE,OAAO,MAAMC,YAAY,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAChC,MAAM;IAAEC,uBAAuB;IAAEC,SAAS;IAAEC;EAAe,CAAC,GAAGR,YAAY,CAAC,CAAC;EAC7E,MAAM,CAACS,SAAS,EAAEC,YAAY,CAAC,GAAGzB,QAAQ,CAAYI,SAAS,CAACsB,IAAI,CAAC;EACrE,MAAM,CAACC,iBAAiB,EAAEC,oBAAoB,CAAC,GAAG5B,QAAQ,CAAagB,UAAU,CAACa,IAAI,CAAC;EACvF,MAAM,CAACC,KAAK,EAAEC,QAAQ,CAAC,GAAG/B,QAAQ,CAAoBK,gBAAgB,CAAC,CAAC,CAAC;EACzE,MAAM,CAAC2B,QAAQ,EAAEC,WAAW,CAAC,GAAGjC,QAAQ,CAAc,IAAI,CAAC;EAC3D,MAAM,CAACkC,KAAK,EAAEC,QAAQ,CAAC,GAAGnC,QAAQ,CAAY;IAC5CoC,KAAK,EAAE,CAAC;IACRC,KAAK,EAAE,CAAC;IACRC,YAAY,EAAE,CAAC;IACfC,KAAK,EAAE,CAAC;IACRC,WAAW,EAAE;EACf,CAAC,CAAC;EACF,MAAM,CAACC,aAAa,EAAEC,gBAAgB,CAAC,GAAG1C,QAAQ,CAAC,KAAK,CAAC;EAEzD,MAAM2C,WAAW,GAAGxC,MAAM,CAAwB,IAAI,CAAC;EACvD,MAAMyC,YAAY,GAAGzC,MAAM,CAAwB,IAAI,CAAC;EACxD,MAAM0C,YAAY,GAAG1C,MAAM,CAAwB,IAAI,CAAC;EACxD,MAAM2C,kBAAkB,GAAG7B,aAAa,CAACU,iBAAiB,CAAC;;EAE3D;EACA,MAAMoB,kBAAkB,GAAG9C,WAAW,CAAC,MAAM;IAC3C,MAAM+C,IAAI,GAAG1C,kBAAkB,CAAC;MAAE2C,GAAG,EAAE,CAAC;MAAEC,GAAG,EAAE;IAAE,CAAC,CAAC;IACnDjB,WAAW,CAACe,IAAI,CAAC;EACnB,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMG,cAAc,GAAGlD,WAAW,CAAC,MAAM;IACvC8B,QAAQ,CAACqB,YAAY,IAAI;MACvB,MAAMC,gBAAgB,GAAG,EAAE;MAC3B,KAAK,IAAIH,GAAG,GAAG,CAAC,EAAEA,GAAG,GAAGpC,WAAW,CAACwC,WAAW,EAAEJ,GAAG,EAAE,EAAE;QACtD,IAAItC,YAAY,CAACwC,YAAY,EAAEF,GAAG,CAAC,EAAE;UACnCG,gBAAgB,CAACE,IAAI,CAACL,GAAG,CAAC;QAC5B;MACF;MAEA,IAAIG,gBAAgB,CAACG,MAAM,KAAK,CAAC,EAAE;QACjC/B,YAAY,CAACrB,SAAS,CAACqD,SAAS,CAAC;QACjC,OAAOL,YAAY;MACrB;MAEA,MAAMM,SAAS,GAAGL,gBAAgB,CAACM,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,GAAGR,gBAAgB,CAACG,MAAM,CAAC,CAAC;MACvF,MAAMP,GAAG,GAAGpC,iBAAiB,CAACuC,YAAY,EAAEM,SAAS,CAAC;MAEtD,IAAIT,GAAG,KAAK,CAAC,CAAC,EAAE;QACdxB,YAAY,CAACrB,SAAS,CAACqD,SAAS,CAAC;QACjC,OAAOL,YAAY;MACrB;MAEA,MAAMJ,IAAI,GAAG1C,kBAAkB,CAAC;QAAE2C,GAAG;QAAEC,GAAG,EAAEQ;MAAU,CAAC,CAAC;MACxD,MAAMI,QAAQ,GAAG,CAAC,GAAGV,YAAY,CAAC;MAClCU,QAAQ,CAACb,GAAG,CAAC,CAACS,SAAS,CAAC,GAAGV,IAAI;MAE/B,OAAOc,QAAQ;IACjB,CAAC,CAAC;EACJ,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMC,cAAc,GAAG9D,WAAW,CAAEmD,YAA+B,IAAK;IACtE,IAAIU,QAAQ,GAAG,CAAC,GAAGV,YAAY,CAACY,GAAG,CAACf,GAAG,IAAI,CAAC,GAAGA,GAAG,CAAC,CAAC,CAAC;IACrD,IAAIgB,YAAY,GAAG,CAAC;IACpB,IAAIC,UAAU,GAAG,CAAC;IAElB,MAAMC,YAAY,GAAGA,CAAA,KAAM;MACzB,MAAMC,OAAO,GAAG7D,cAAc,CAACuD,QAAQ,CAAC;MAExC,IAAIM,OAAO,CAACZ,MAAM,KAAK,CAAC,EAAE;QACxB;QACA,IAAIS,YAAY,GAAG,CAAC,EAAE;UACpB,MAAMI,SAAS,GAAG3D,cAAc,CAACuD,YAAY,EAAEC,UAAU,CAAC;UAC1D/B,QAAQ,CAACmC,IAAI,IAAI;YACf,MAAMC,QAAQ,GAAGD,IAAI,CAAClC,KAAK,GAAGiC,SAAS;YACvC,MAAMG,QAAQ,GAAG;cACf,GAAGF,IAAI;cACPlC,KAAK,EAAEmC,QAAQ;cACfjC,YAAY,EAAEgC,IAAI,CAAChC,YAAY,GAAGqB,IAAI,CAACC,KAAK,CAACK,YAAY,GAAGnB,kBAAkB,CAAC2B,aAAa,CAAC;cAC7FlC,KAAK,EAAE2B,UAAU;cACjB7B,KAAK,EAAEsB,IAAI,CAACC,KAAK,CAACW,QAAQ,GAAG,IAAI,CAAC,GAAG;YACvC,CAAC;;YAED;YACA,IAAIA,QAAQ,IAAIzB,kBAAkB,CAAC4B,WAAW,IAAI,CAACjC,aAAa,EAAE;cAChEkC,OAAO,CAACC,GAAG,CAAC,iBAAiB,EAAE;gBAAEL,QAAQ;gBAAEM,MAAM,EAAE/B,kBAAkB,CAAC4B,WAAW;gBAAEjC;cAAc,CAAC,CAAC;cACnGqC,UAAU,CAAC,MAAMpC,gBAAgB,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC;YAChD;YAEA,OAAO8B,QAAQ;UACjB,CAAC,CAAC;;UAEF;UACAM,UAAU,CAAC,MAAM;YACf3C,QAAQ,CAACmC,IAAI,KAAK;cAAE,GAAGA,IAAI;cAAE/B,KAAK,EAAE;YAAE,CAAC,CAAC,CAAC;UAC3C,CAAC,EAAE,IAAI,CAAC;QACV;QACA;MACF;;MAEA;MACAuB,QAAQ,GAAGrD,WAAW,CAACqD,QAAQ,EAAEM,OAAO,CAAC;MACzCH,YAAY,IAAIG,OAAO,CAACZ,MAAM;MAC9BU,UAAU,EAAE;;MAEZ;MACAY,UAAU,CAAC,MAAM;QACf;QACAV,OAAO,CAACW,OAAO,CAACC,GAAG,IAAI;UACrBlB,QAAQ,CAACkB,GAAG,CAAC/B,GAAG,CAAC,CAAC+B,GAAG,CAAC9B,GAAG,CAAC,GAAG,IAAI;QACnC,CAAC,CAAC;;QAEF;QACAY,QAAQ,GAAGtD,YAAY,CAACsD,QAAQ,CAAC;QACjC/B,QAAQ,CAAC+B,QAAQ,CAAC;;QAElB;QACAgB,UAAU,CAAC,MAAMX,YAAY,CAAC,CAAC,EAAE,GAAG,CAAC;MACvC,CAAC,EAAE,GAAG,CAAC;IACT,CAAC;IAEDA,YAAY,CAAC,CAAC;EAChB,CAAC,EAAE,CAACrB,kBAAkB,CAAC2B,aAAa,EAAE3B,kBAAkB,CAAC4B,WAAW,EAAEjC,aAAa,CAAC,CAAC;;EAErF;EACA,MAAMwC,SAAS,GAAGhF,WAAW,CAAEiF,UAAuB,IAAK;IACzD,IAAIA,UAAU,EAAE;MACdtD,oBAAoB,CAACsD,UAAU,CAAC;IAClC;IACAzD,YAAY,CAACrB,SAAS,CAAC+E,OAAO,CAAC;IAC/BpD,QAAQ,CAAC1B,gBAAgB,CAAC,CAAC,CAAC;IAC5B8B,QAAQ,CAAC;MACPC,KAAK,EAAE,CAAC;MACRC,KAAK,EAAE,CAAC;MACRC,YAAY,EAAE,CAAC;MACfC,KAAK,EAAE,CAAC;MACRC,WAAW,EAAE;IACf,CAAC,CAAC;IACFE,gBAAgB,CAAC,KAAK,CAAC;IACvBK,kBAAkB,CAAC,CAAC;;IAEpB;IACA,IAAIF,YAAY,CAACuC,OAAO,EAAEC,aAAa,CAACxC,YAAY,CAACuC,OAAO,CAAC;IAC7DvC,YAAY,CAACuC,OAAO,GAAGE,WAAW,CAAC,MAAM;MACvCnD,QAAQ,CAACmC,IAAI,KAAK;QAAE,GAAGA,IAAI;QAAE9B,WAAW,EAAE8B,IAAI,CAAC9B,WAAW,GAAG;MAAE,CAAC,CAAC,CAAC;IACpE,CAAC,EAAE,IAAI,CAAC;IAER,MAAM+C,WAAW,GAAGL,UAAU,GAAGjE,aAAa,CAACiE,UAAU,CAAC,GAAGpC,kBAAkB;;IAE/E;IACA,IAAIF,YAAY,CAACwC,OAAO,EAAEC,aAAa,CAACzC,YAAY,CAACwC,OAAO,CAAC;IAC7DxC,YAAY,CAACwC,OAAO,GAAGE,WAAW,CAAC,MAAM;MACvCnC,cAAc,CAAC,CAAC;IAClB,CAAC,EAAEoC,WAAW,CAACC,YAAY,CAAC;EAC9B,CAAC,EAAE,CAACzC,kBAAkB,EAAEI,cAAc,EAAEL,kBAAkB,CAAC,CAAC;;EAE5D;EACA,MAAM2C,SAAS,GAAGxF,WAAW,CAAC,MAAM;IAClCwB,YAAY,CAACrB,SAAS,CAACsF,MAAM,CAAC;IAC9B,IAAI9C,YAAY,CAACwC,OAAO,EAAEC,aAAa,CAACzC,YAAY,CAACwC,OAAO,CAAC;IAC7D,IAAIvC,YAAY,CAACuC,OAAO,EAAEC,aAAa,CAACxC,YAAY,CAACuC,OAAO,CAAC;EAC/D,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMO,UAAU,GAAG1F,WAAW,CAAC,MAAM;IACnCwB,YAAY,CAACrB,SAAS,CAAC+E,OAAO,CAAC;IAE/B,IAAItC,YAAY,CAACuC,OAAO,EAAEC,aAAa,CAACxC,YAAY,CAACuC,OAAO,CAAC;IAC7DvC,YAAY,CAACuC,OAAO,GAAGE,WAAW,CAAC,MAAM;MACvCnD,QAAQ,CAACmC,IAAI,KAAK;QAAE,GAAGA,IAAI;QAAE9B,WAAW,EAAE8B,IAAI,CAAC9B,WAAW,GAAG;MAAE,CAAC,CAAC,CAAC;IACpE,CAAC,EAAE,IAAI,CAAC;IAER,IAAII,YAAY,CAACwC,OAAO,EAAEC,aAAa,CAACzC,YAAY,CAACwC,OAAO,CAAC;IAC7DxC,YAAY,CAACwC,OAAO,GAAGE,WAAW,CAAC,MAAM;MACvCnC,cAAc,CAAC,CAAC;IAClB,CAAC,EAAErC,WAAW,CAAC8E,aAAa,CAAC;EAC/B,CAAC,EAAE,CAACzC,cAAc,CAAC,CAAC;;EAEpB;EACA,MAAM0C,OAAO,GAAG5F,WAAW,CAAC,MAAM;IAChCwB,YAAY,CAACrB,SAAS,CAACqD,SAAS,CAAC;IACjC,IAAIb,YAAY,CAACwC,OAAO,EAAEC,aAAa,CAACzC,YAAY,CAACwC,OAAO,CAAC;IAC7D,IAAIvC,YAAY,CAACuC,OAAO,EAAEC,aAAa,CAACxC,YAAY,CAACuC,OAAO,CAAC;IAC7D,IAAIzC,WAAW,CAACyC,OAAO,EAAEC,aAAa,CAAC1C,WAAW,CAACyC,OAAO,CAAC;;IAE3D;IACA/D,uBAAuB,CAACa,KAAK,CAACE,KAAK,EAAEF,KAAK,CAACG,KAAK,CAAC;EACnD,CAAC,EAAE,CAAChB,uBAAuB,EAAEa,KAAK,CAACE,KAAK,EAAEF,KAAK,CAACG,KAAK,CAAC,CAAC;;EAEvD;EACA,MAAMyD,eAAe,GAAG7F,WAAW,CAAC,CAACgD,GAAW,EAAEC,GAAW,KAAK;IAChE,IAAI1B,SAAS,KAAKpB,SAAS,CAAC+E,OAAO,IAAI,CAACnD,QAAQ,EAAE;IAElD,MAAM+D,SAAS,GAAGlF,iBAAiB,CAACiB,KAAK,EAAEoB,GAAG,CAAC;IAC/C,IAAI6C,SAAS,KAAK,CAAC,CAAC,EAAE,OAAO,CAAC;;IAE9B;IACA,MAAMjC,QAAQ,GAAG,CAAC,GAAGhC,KAAK,CAAC;IAC3B,MAAMkE,WAAW,GAAG;MAAE,GAAGhE,QAAQ;MAAEiE,QAAQ,EAAE;QAAEhD,GAAG,EAAE8C,SAAS;QAAE7C;MAAI;IAAE,CAAC;IACtEY,QAAQ,CAACiC,SAAS,CAAC,CAAC7C,GAAG,CAAC,GAAG8C,WAAW;IAEtCjE,QAAQ,CAAC+B,QAAQ,CAAC;;IAElB;IACAf,kBAAkB,CAAC,CAAC;;IAEpB;IACA+B,UAAU,CAAC,MAAM;MACff,cAAc,CAACD,QAAQ,CAAC;IAC1B,CAAC,EAAE,GAAG,CAAC;;IAEP;IACA,IAAInD,UAAU,CAACmD,QAAQ,CAAC,EAAE;MACxB+B,OAAO,CAAC,CAAC;IACX;EACF,CAAC,EAAE,CAACrE,SAAS,EAAEQ,QAAQ,EAAEF,KAAK,EAAEiC,cAAc,EAAEhB,kBAAkB,EAAE8C,OAAO,CAAC,CAAC;;EAE7E;EACA,MAAMK,SAAS,GAAGjG,WAAW,CAAC,MAAM;IAClCwB,YAAY,CAACrB,SAAS,CAACsB,IAAI,CAAC;IAC5BK,QAAQ,CAAC1B,gBAAgB,CAAC,CAAC,CAAC;IAC5B8B,QAAQ,CAAC;MACPC,KAAK,EAAE,CAAC;MACRC,KAAK,EAAE,CAAC;MACRC,YAAY,EAAE,CAAC;MACfC,KAAK,EAAE,CAAC;MACRC,WAAW,EAAE;IACf,CAAC,CAAC;IACFP,WAAW,CAAC,IAAI,CAAC;IAEjB,IAAIW,YAAY,CAACwC,OAAO,EAAEC,aAAa,CAACzC,YAAY,CAACwC,OAAO,CAAC;IAC7D,IAAIvC,YAAY,CAACuC,OAAO,EAAEC,aAAa,CAACxC,YAAY,CAACuC,OAAO,CAAC;IAC7D,IAAIzC,WAAW,CAACyC,OAAO,EAAEC,aAAa,CAAC1C,WAAW,CAACyC,OAAO,CAAC;EAC7D,CAAC,EAAE,EAAE,CAAC;;EAEN;EACAlF,SAAS,CAAC,MAAM;IACd,OAAO,MAAM;MACX,IAAI0C,YAAY,CAACwC,OAAO,EAAEC,aAAa,CAACzC,YAAY,CAACwC,OAAO,CAAC;MAC7D,IAAIvC,YAAY,CAACuC,OAAO,EAAEC,aAAa,CAACxC,YAAY,CAACuC,OAAO,CAAC;MAC7D;MACA,IAAIzC,WAAW,CAACyC,OAAO,EAAEC,aAAa,CAAC1C,WAAW,CAACyC,OAAO,CAAC;IAC7D,CAAC;EACH,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMe,gBAAgB,GAAGlG,WAAW,CAAC,MAAM;IACzC,MAAMmG,IAAI,GAAGlF,YAAY,CAACS,iBAAiB,CAAC;IAC5C,IAAIyE,IAAI,EAAE;MACR1D,gBAAgB,CAAC,KAAK,CAAC;MACvBd,oBAAoB,CAACwE,IAAI,CAACC,EAAE,CAAC;MAC7B;MACAvB,UAAU,CAAC,MAAM;QACfG,SAAS,CAACmB,IAAI,CAACC,EAAE,CAAC;MACpB,CAAC,EAAE,GAAG,CAAC;IACT;EACF,CAAC,EAAE,CAAC1E,iBAAiB,EAAEsD,SAAS,CAAC,CAAC;;EAElC;EACA,MAAMqB,oBAAoB,GAAGrG,WAAW,CAAEiF,UAAsB,IAAK;IACnEtD,oBAAoB,CAACsD,UAAU,CAAC;EAClC,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMqB,kBAAkB,GAAGtG,WAAW,CAAC,MAAM;IAC3CyC,gBAAgB,CAAC,KAAK,CAAC;EACzB,CAAC,EAAE,EAAE,CAAC;EAEN,OAAO;IACLlB,SAAS;IACTM,KAAK;IACLE,QAAQ;IACRE,KAAK;IACLZ,SAAS;IACTC,cAAc;IACdI,iBAAiB;IACjBmB,kBAAkB;IAClBL,aAAa;IACbwC,SAAS;IACTQ,SAAS;IACTE,UAAU;IACVO,SAAS;IACTM,SAAS,EAAEL,gBAAgB;IAC3BM,aAAa,EAAEH,oBAAoB;IACnCC,kBAAkB;IAClBT;EACF,CAAC;AACH,CAAC;AAAC1E,EAAA,CA5RWD,YAAY;EAAA,QACwCJ,YAAY;AAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}