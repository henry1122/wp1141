# My-X 功能实现总结

## ✅ 已完成的功能

### 🔐 注册与登录
- ✅ **OAuth 登录**：支持 Google、GitHub、Facebook 三种 OAuth 登录方式
- ✅ **UserID 注册**：注册时需要输入 userID（3-20 字符，仅字母数字和下划线）
- ✅ **UserID 登录**：可以使用注册时的 userID 直接登录
- ✅ **Session 管理**：登录后创建 session，30 天内有效
- ✅ **不同 OAuth Provider 独立账户**：使用不同 OAuth provider 注册会创建不同的 userID

### 🎨 主选单（侧边栏）
- ✅ **Home**：回到 X 的 home 页面
- ✅ **Profile**：进入个人首页
- ✅ **Post**：发表贴文（明亮底色按钮）
- ✅ **用户信息**：显示头像、姓名、UserID
- ✅ **Logout**：点击用户信息弹出 logout 选项
- ✅ **Hover 效果**：按钮 hover 时会有微亮 highlight

### 👤 个人资料页面
- ✅ **编辑模式**（自己的资料）：
  - 显示姓名（从 OAuth 获取）
  - Number of posts
  - 回到 Home 的左箭头
  - 背景图（可编辑）
  - "Edit Profile" 按钮（可编辑个人资料）
  - 大头贴（Avatar）
  - 姓名和 @userID
  - Brief description（可编辑）
  - Number of following/followers
  - Posts 标签页（显示所有 post/repost）
  - Likes 标签页（仅自己可见）

- ✅ **查看模式**（别人的资料）：
  - "Follow"/"Following" 按钮（替代 Edit Profile）
  - Posts 标签页（显示该用户的所有 post/repost）
  - 不显示 Likes 标签页

### 📝 发表文章
- ✅ **Post 按钮**：点击后弹出 modal 窗口
- ✅ **字符限制**：280 字符限制
- ✅ **链接识别**：自动识别链接，每个链接占 23 字符
- ✅ **Hashtag**：支持 #Hashtag，不计入字符数
- ✅ **@Mention**：支持 @mention，不计入字符数，点击可跳转到用户资料
- ✅ **放弃发帖**：点击左上 x 会询问是否放弃
  - Save：存成 Draft
  - Discard：真的放弃（无法 undo）
- ✅ **Drafts**：可以查看和管理草稿列表

### 📖 阅读文章
- ✅ **Home Feed**：
  - "All" 标签：显示所有文章
  - "Following" 标签：显示关注的人的文章和 repost
  - 文章排序：从最新到最旧
  - Inline 发帖：点击输入框展开类似 Post modal 的布局

- ✅ **文章显示**：
  - 作者头像
  - 发文时间（几秒/分钟/小时/天/月/年前）
  - 完整内容显示
  - 留言数、转发数、按爱心数
  - 点击可留言、转发、给爱心
  - 爱心 toggle on/off，有颜色区别
  - 删除贴文：自己的发文可以在右上 "..." 删除（repost 不能删除）

- ✅ **递归评论**：
  - 点击文章进入详情页，显示文章和所有评论
  - 点击评论可以进入该评论的详情页
  - 支持多层嵌套评论
  - 左箭头 + Post 按钮可以回到上一层

### 🤼 实时互动（Pusher）
- ✅ **实时更新**：
  - 按赞会实时更新赞数
  - 留言会实时更新留言数
  - 转发会实时更新转发数
  - 新文章会实时显示在 All feed 中

### ✏️ UI/UX 设计
- ✅ **右侧栏**：已省略
- ✅ **响应式设计**：适配不同屏幕尺寸
- ✅ **暗色主题**：使用 Twitter 风格的暗色主题

## 🔧 技术实现

### 数据库（MongoDB + Prisma）
- ✅ 使用 Prisma ORM 管理数据库
- ✅ 支持 MongoDB Atlas 连接
- ✅ 数据模型完整（User, Post, Comment, Like, Repost, Follow, Draft）

### 认证（NextAuth）
- ✅ 支持 Google、GitHub、Facebook OAuth
- ✅ 数据库 session 策略
- ✅ UserID 注册和登录系统

### 实时通信（Pusher）
- ✅ 服务器端 Pusher 集成
- ✅ 客户端 Pusher 订阅
- ✅ 实时更新点赞、评论、转发

### 文件上传（Cloudinary）
- ✅ 支持图片上传
- ✅ 背景图上传功能

## 📋 待配置的环境变量

请确保 `.env.local` 包含以下变量：

```env
# NextAuth
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-secret

# OAuth
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
GITHUB_ID=your-github-id
GITHUB_SECRET=your-github-secret
FACEBOOK_CLIENT_ID=your-facebook-id (可选)
FACEBOOK_CLIENT_SECRET=your-facebook-secret (可选)

# Database
DATABASE_URL=mongodb+srv://hocashi:P%40qq3849@cluster0.suswhjg.mongodb.net/my-x?retryWrites=true&w=majority

# Pusher
PUSHER_APP_ID=your-pusher-app-id
PUSHER_KEY=your-pusher-key
PUSHER_SECRET=your-pusher-secret
PUSHER_CLUSTER=your-pusher-cluster
NEXT_PUBLIC_PUSHER_KEY=your-pusher-key
NEXT_PUBLIC_PUSHER_CLUSTER=your-pusher-cluster

# Cloudinary (可选)
CLOUDINARY_CLOUD_NAME=your-cloudinary-name
CLOUDINARY_API_KEY=your-cloudinary-key
CLOUDINARY_API_SECRET=your-cloudinary-secret
```

## 🚀 部署到 Vercel

1. **推送代码到 GitHub**
2. **在 Vercel 导入项目**
3. **配置环境变量**（参考上面的列表）
4. **确保 MongoDB Atlas IP 白名单包含 `0.0.0.0/0`**
5. **更新 OAuth 回调 URL**：
   - Google: `https://your-domain.vercel.app/api/auth/callback/google`
   - GitHub: `https://your-domain.vercel.app/api/auth/callback/github`
   - Facebook: `https://your-domain.vercel.app/api/auth/callback/facebook`

## 📝 注意事项

1. **MongoDB 连接字符串**：如果密码包含特殊字符，需要进行 URL 编码
2. **Pusher 配置**：需要同时配置服务器端和客户端变量
3. **OAuth 回调 URL**：本地开发使用 `http://localhost:3000`，生产环境使用实际域名
4. **Session 策略**：使用数据库 session，确保 MongoDB 连接正常

## ✨ 功能亮点

- ✅ 完整的 OAuth 登录系统
- ✅ 实时互动（Pusher）
- ✅ 递归评论系统
- ✅ 字符计数（考虑链接、Hashtag、Mention）
- ✅ 草稿功能
- ✅ 关注/取消关注
- ✅ 个人资料编辑
- ✅ 响应式设计

